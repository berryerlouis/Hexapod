////////////////////////////////////////INCLUDES//////////////////////////////////////////////////
#include "Conf/ConfHard.h"

#include "Drv/DrvAdc.h"
#include "Srv/SrvBattery.h"

////////////////////////////////////////PRIVATE DEFINES///////////////////////////////////////////

////////////////////////////////////////PRIVATE STRUCTURES////////////////////////////////////////

////////////////////////////////////////PRIVATE FUNCTIONS/////////////////////////////////////////

////////////////////////////////////////PRIVATE VARIABLES/////////////////////////////////////////
SBatteryInfo batteryInfo; 
////////////////////////////////////////PUBILC FUNCTIONS//////////////////////////////////////////



//Fonction d'initialisation
Boolean SrvBatteryInit ( void ) 
{
	batteryInfo.percentage = 0U;
	batteryInfo.milliVolt = 0U;
	return DrvAdcInit();
}

//Fonction de dispatching d'evenements
void SrvBatteryUpdate (void)
{
	#define MAX_VOLATGE 170.0
	#define MIN_VOLATGE 130.0
	batteryInfo.milliVolt = (uint16_t)DrvAdcRead(EIO_PIN_A_0);
	batteryInfo.percentage = (batteryInfo.milliVolt * 100U) / MAX_VOLATGE;
}

SBatteryInfo* SrvBatteryGetStruct (void) 
{
	return &batteryInfo;
}